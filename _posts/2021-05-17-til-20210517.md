---
layout: post
title: App Delegate 메서드란?
tags:
  - TIL
  - AppDelegate
  - UIApplication
---

iOS 앱의 상태 변화에 따른 동작을 처리하는 App Delegate 메서드들이 있다.
이 메서드들과 함께 앱이 어떠한 실행과정을 거쳐서 AppDelegate를 생성하는지까지 알아보려한다.
내가 원하는 동작을 효과적으로 구현하기 위해서는 iOS와 UIKit 프레임워크가 어떻게 동작하는지 이해하는게 중요하다.

## iOS App의 실행과정
먼저 앱의 실행과정을 알아본다. 실행과정은 아래와 같다.

> 1. main 함수 실행
2. UIKit 프레임워크의 [UIApplicationMain(_ : _ : _ : _ :)](https://developer.apple.com/documentation/uikit/1622933-uiapplicationmain) 함수 실행
  - 1) [UIApplication](https://developer.apple.com/documentation/uikit/uiapplication) 싱글턴 객체 생성
  - 2) [AppDelegate](https://developer.apple.com/documentation/uikit/uiapplicationdelegate) 객체 생성 및 [UIApplication](https://developer.apple.com/documentation/uikit/uiapplication) 객체와 연결(delegate 설정)
  - 3) [UIApplication](https://developer.apple.com/documentation/uikit/uiapplication) 객체가 info.plist 파일에서 앱 실행에 필요한 데이터와 객체 로드
  - 4) [UIApplication](https://developer.apple.com/documentation/uikit/uiapplication) 객체가 Main Event Loop를 생성하고 관리
  - 5) (Info.plist에 main storyboard 세팅된 경우) [UIApplication](https://developer.apple.com/documentation/uikit/uiapplication) 객체가 main NIB 파일에서 main UI 로드
3. AppDelegate의 [application(_:willFinishLaunchingWithOptions:)](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623032-application) 호출
4. AppDelegate 및 ViewControllers의 추가 메서드를 호출하여 앱 상태 복원
5. AppDelegate의 [application(_:didFinishLaunchingWithOptions:)](https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1622921-application) 호출
6. (Info.plist에 main storyboard 세팅되지 않은 경우) main UI 로드
7. 앱 이벤트 루프에서 이벤트 핸들링 시작
8. 앱 사용!

<br>
<p align="center">
   <img src="../images/2021-05-17-til-20210517/1.png" width="700" />
   <em style="font-size: 0.9em;">출처: https://oleb.net/blog/2012/02/app-launch-sequence-ios-revisited/</em>
</p>
<br>

<p align="center">
   <img src="../images/2021-05-17-til-20210517/2.png" width="600" />
   <em style="font-size: 0.9em;">출처: https://stackoverflow.com/questions/17366107/what-is-the-launch-sequence-of-an-ios-app</em>
</p>
<br>

### main 함수와 UIApplicationMain
swift에서는 main.m이 자동으로 생성되는 Objective-C와 다르게,
Appdelegate.swift의 @UIApplicationMain 어노테이션을 없애고 main.swift를 직접 생성하여 main 함수를 커스텀할 수 있습니다.

~~~ swift
import UIKit

UIApplicationMain(CommandLine.argc,
                  UnsafeMutableRawPointer(CommandLine.unsafeArgv).bindMemory(
                      to: UnsafeMutablePointer<Int8>.self,
                      capacity: Int(CommandLine.argc)),
                  nil,
                  NSStringFromClass(AppDelegate.self))
~~~

main 함수에서 실행되는 [UIApplicationMain(_ : _ : _ : _ :)](https://developer.apple.com/documentation/uikit/1622933-uiapplicationmain) 함수는 UIApplication 객체와 AppDelegate 객체를 생성하여 연결(delegate)하고 Main Event Loop를 세팅합니다. Main Event Loop는 앱의 Run Loop를 포함하며 처리 이벤트를 시작합니다.

공식문서에서 [UIApplicationMain(_ : _ : _ : _ :)](https://developer.apple.com/documentation/uikit/1622933-uiapplicationmain) 함수의 선언부분을 보면 아래와 같습니다.

<p align="center">
   <img src="../images/2021-05-17-til-20210517/3.png" width="700"/>
</p>

3,4번째 파라미터인 principalClassName와 delegateClassName 는 각각 [UIApplication](https://developer.apple.com/documentation/uikit/uiapplication) 클래스 이름과 [AppDelegate](https://developer.apple.com/documentation/uikit/uiapplicationdelegate)로 초기화될 클래스 이름입니다.

### UIApplication
[UIApplication](https://developer.apple.com/documentation/uikit/uiapplication)은 iOS에서 실행되는 앱을 위한 중앙화된 제어 및 조정 지점... 이라고 한다. 공식문서에서 [UIApplication](https://developer.apple.com/documentation/uikit/uiapplication)의 선언부분을 보면 아래와 같습니다.

<p align="center">
   <img src="../images/2021-05-17-til-20210517/4.png" width="700"/>
</p>

[UIResponder](https://developer.apple.com/documentation/uikit/uiresponder) 클래스는 이벤트에 반응하여 처리하는 추상 인터페이스이다. UIResponder 인스턴스는 UIKit 앱의 이벤트를 처리하는 **백본**을 구성한다. [UIApplication](https://developer.apple.com/documentation/uikit/uiapplication) 뿐만 아니라 [UIViewController](https://developer.apple.com/documentation/uikit/uiviewcontroller), [UIView](https://developer.apple.com/documentation/uikit/uiview) 또한 responder가 될 수 있으며, 이벤트가 발생할 때 UIKit은 이벤트를 해당 UIResponder로 dispatch 한다.

이니셜 라우팅, 들어오는 유저 이벤트 처리. 액션 메시지를 UIControl 인스턴스로부터 적절한 타겟 객체로 보낸다. 얘는 오픈된 UIWindow 리스트를 유지하고 이로부터 UIView 오브젝트를 가져올 수 있다.

UIApplication은 UIApplication Delegate 프로토콜을 따르는 delegate를 정의하고 반드시 몇ㅊ개의 프로토콜 메서드를 추가해야 한다. UIApplication은 중요한 런타임 이벤트를 delegate에 알리는데 이는 앱 런치, 저메모리 워닝, 앱 제거 등이 있고 적절하게 대응할 수 있는 기회를 준다.

앱은 메일이나 이미지 파일등의 리소스를 처리할 수 있는다. open 메서드로. 예를 들어 앱에서 email URL을 호출하면 MAil 앱이 런치되고 메시지가 보여진다. 이 클래스의 API는 너가 디바이스 명시적 행동을 관리하도록 허락한다. UIApplication 오브젝트는 아래의 것ㄷ르을 할 수 있다.

- 

대부분의 앱은 UIApplication 을 서브클래싱 할 필요가 없으나, 시스템과 앱 사이의 상호작용을 관리하기 위해 app delegate를 사용한다. 니 앱이 반드시 들어오는 이벤트를 시스템 전ㄴ에 처리해야한다면, UIApplcation을 서브클래싱하고 sendEvent나 sendAction을 오버라이딩해서 니 할일 선처리하고 super. 메서드로 시스템한테 다시 dispath 하면 된다. 되도록이면 안하는게 좋다.

## AppDelegate

## AppDelegate의 메서드
각 메소드가 call 되는 시점 및 어떤 행동을 하는지

https://programmersought.com/article/7299631766/
https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1623032-application
(저장되어있는 데이터나 상태를 바탕으로 UI를 세팅. 이 단계는 inactive 상태. willFinishLaunchingWithOptions method is called after your app has been launched and its main storyboard or nib file has been loaded, but before your app’s state has been restored )

## 결론

## 레퍼런스
- [https://oleb.net/blog/2012/02/app-launch-sequence-ios-revisited/](https://oleb.net/blog/2012/02/app-launch-sequence-ios-revisited/)
- [https://stackoverflow.com/questions/17366107/what-is-the-launch-sequence-of-an-ios-app](https://stackoverflow.com/questions/17366107/what-is-the-launch-sequence-of-an-ios-app)
- [https://developer.apple.com/documentation/uikit/app-and-environment/responding-to-the-launch-of-your-app/about-the-app-launch_sequence](https://developer.apple.com/documentation/uikit/app_and_environment/responding_to_the_launch_of_your_app/about_the_app_launch_sequence)
- [https://medium.com/@anandin02/ios-application-launch-sequence-a13a267d1669](https://medium.com/@anandin02/ios-application-launch-sequence-a13a267d1669)
- [https://zeddios.tistory.com/1049](https://zeddios.tistory.com/1049)