---
layout: post
title: iOS 앱이 Foreground에 있을 때와 Background에 있을 때 어떤 차이점이 있을까?
tags:
  - TIL
  - iOS App Lifecycle
  - iOS Background Mode
---

앱이 Foreground(Active, inActive)에 있을 때와 Background에 있을 때의 차이점을 알아본다.
각 상태에서 어떤 일을 할 수 있고 할 수 없는 지에 대해 파악하는 것은 실제 개발을 할 때 매우 중요하다.

## iOS 앱 라이프사이클
iOS 13에서 Scene이 도입되면서 앱은 Scene-based와 App-based로 나뉜다.
그에 따라 라이프사이클 이벤트에 대응되는 객체도 UISceneDelegate, UIApplicationDelegate로 나뉘는데,
Scene에 관련된 내용은 나중에 정리하도록하고 먼저 App-based 기준으로 iOS 앱의 라이프사이클을 알아본다.

<p align="center">
   <img src="../images/2021-05-08-til-20210508/1.png" width="500" />
   <em>출처: Apple Developer</em>
</p>

iOS 12 이하 버전이나 Scene을 지원하지 않는 앱에서 UIKit은 모든 라이프사이클 이벤트를 UIApplicationDelegate로 전달한다.
이러한 앱 delegate는 분리된 스크린에서 보여지는 앱의 모든 window를 관리한다. 그에 따라 앱의 상태 변화는 외부 디스플레이의 컨텐츠를 포함한
앱 전체의 UI에 영향을 미친다. 

위의 그림은 앱 delegate 객체와 관련된 앱의 상태 변화를 보여준다. 앱이 실행되면 시스템은 UI가 스크린에 보여지는지 아닌지 여부에 따라
앱을 Inactive나 Background 상태로 만든다. 앱이 Foreground로 시작될 때, 시스템은 자동으로 앱을 active 상태로 바꾼다.
그 후, 앱은 terminate 되기 전까지 active와 background 사이에서 변동된다.

따라서 App-based 라이프사이클에서 앱이 갖게되는 상태는 5가지로 나뉜다.

1. `Not Running` : 
2. `Inactive` : 
3. `Active` : 
4. `Background` : 
5. `Suspended` : 


https://eunjin3786.tistory.com/163
https://developer.apple.com/documentation/uikit/app_and_environment/managing_your_app_s_life_cycle

## Foreground 제약사항
더 효율적인 작업을 위해 Qos(Quality of service)를 고려해야한다.
더 깊은 내용은 추후 정리할 예정. 컨셉만 소개

https://zeddios.tistory.com/521

## Background 제약사항
백그라운드에서 약간의 작업이 필요할 때
https://hamait.tistory.com/715

NSURLSession로 다운로드나 전송할 때도 백그라운드에서 별도의 세팅을 해주어야 함
https://rhammer.tistory.com/109

백그라운드 모드를 활용해야 원하는 Task를 수행할 수 있음
https://hamait.tistory.com/715

보통 뭐 리소스 제약사항임
https://developer.apple.com/documentation/uikit/app_and_environment/scenes/preparing_your_ui_to_run_in_the_background

저전력모드에서 임의로 백그라운드 태스킹이 종료될 수 있음
https://developer.apple.com/library/archive/documentation/Performance/Conceptual/EnergyGuide-iOS/LowPowerMode.html#//apple_ref/doc/uid/TP40015243-CH31-SW1

## 결론
백그라운드 환경에서의 제약사항이 많은 만큼 어떤 작업을 적절히 수행하기 위한 방법을 잘 파악하고 있어야함.