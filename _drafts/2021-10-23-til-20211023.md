---
layout: post
title: iOS 앱의 핵심 객체 - UIApplication, AppDelegate, UIWindow
tags:
  - TIL
  - UIKit
  - UIApplication
  - AppDelegate
  - UIWindow
  - iOS
  - iOS Life Cycle
---

iOS 앱(**UIKit 프레임워크**)을 구성하는 핵심 객체들이 무엇이며 어떤 역할을 하는 객체인지 알아봅니다.

## UIKit 프레임워크의 핵심 객체들

### 1) UIApplication
> [UIApplication](https://developer.apple.com/documentation/uikit/uiapplication)은 시스템으로부터 이벤트를 받아 처리해주는 객체입니다.

UIKit 프레임워크에서 main이 실행되면, @UIApplicationMain 어노테이션이 선언된 클래스에서 [UIApplicationMain](https://developer.apple.com/documentation/uikit/1622933-uiapplicationmain) 메서드를 실행하게 되는데, 이 메서드가 실행됨에 따라 UIApplication 객체가 생성됩니다. 

UIApplication은 앱의 main event loop를 실행시키고 loop로 들어오는 다양한 이벤트가 적절하게 처리될 수 있도록 앱의 초기 라우팅을 처리합니다.
일반적인 유저 이벤트 뿐만 아니라 앱의 상태변화, 푸시 이벤트 처리, 앱 상태복원 작업 등 앱에서 발생하는 이벤트를 전반적으로
처리해주는 매우 중요한 객체이며, 특별한 케이스를 제외하고 앱은 1개의 UIApplication 객체만을 갖기 때문에 싱글턴 형태로 생성되어 shared로 앱 전역에서 접근이 가능하도록 설계되어있습니다.

UIApplication은 아래와 같은 역할을 담당합니다.

1. `유저 이벤트의 초기 라우팅 처리`  
UIView 객체를 포함한 UIWindow 객체 리스트를 갖고있으며 발생한 이벤트를 지정된 UIWindow 객체에 보내서 적합한 UIView 객체가 받아서 처리하도록 해줍니다.
2. `UIApplicationDelegate 프로토콜을 준수하는 delegate(=AppDelegate)를 정의` 
UIApplication은 [UIApplicationDelegate](https://developer.apple.com/documentation/uikit/uiapplicationdelegate) 프로토콜을 준수하는 객체에 앱 시작, 메모리 부족 경고, 앱 종료 등과 같은 중요한 런타임 이벤트를 전달함으로서 앱이 적절하게 대응할 수 있도록 해줍니다.
3. `이메일 또는 이미지 파일과 같은 리소스 처리`  
email URL로 [open(_:options:completionHandler:)](https://developer.apple.com/documentation/uikit/uiapplication/1648685-open) 메서드를 호출하면 Mail 앱을 실행시킵니다.
4. `제공하는 API로 다양한 동작 수행 가능`  
- 원격 알림 등록 ([registerForRemoteNotifications()](https://developer.apple.com/documentation/uikit/uiapplication/1623078-registerforremotenotifications))
- 실행취소-재실행 UI 트리거 ([applicationSupportsShakeToEdit](https://developer.apple.com/documentation/uikit/uiapplication/1623127-applicationsupportsshaketoedit))
- URL 스킴을 처리하기 위해 등록된 앱이 설치되어있는지 결정 ([canOpenURL(_:)](https://developer.apple.com/documentation/uikit/uiapplication/1622952-canopenurl))
- 백그라운드 작업을 완료할 수 있도록하기 위한 앱 실행 확장 ([beginBackgroundTask(expirationHandler:)](https://developer.apple.com/documentation/uikit/uiapplication/1623031-beginbackgroundtask) and [beginBackgroundTask(withName:expirationHandler:)](https://developer.apple.com/documentation/uikit/uiapplication/1623051-beginbackgroundtask))
- 로컬 알림 스케쥴링 및 취소 ([scheduleLocalNotification(:)](https://developer.apple.com/documentation/uikit/uiapplication/1623005-schedulelocalnotification) and [cancelLocalNotification(_:)](https://developer.apple.com/documentation/uikit/uiapplication/1623082-cancellocalnotification))
- 원격-제어 이벤트 수신 조정 ([beginReceivingRemoteControlEvents()](https://developer.apple.com/documentation/uikit/uiapplication/1623126-beginreceivingremotecontrolevent) and [endReceivingRemoteControlEvents()](https://developer.apple.com/documentation/uikit/uiapplication/1623057-endreceivingremotecontrolevents))
- 앱 상태 복원 작업 수행 ([상태 복원 작업을 관리하는 그룹](https://developer.apple.com/documentation/uikit/uiapplication#1657552)의 메서드)

### 2) UIWindow
> [UIWindow](https://developer.apple.com/documentation/uikit/uiwindow)는 앱의 UI를 보여주는 배경(backdrop)이자 View와 View Controller에 이벤트를 전달하는 객체입니다.

UIWindow는 뷰들을 담는 일종의 **컨테이너**입니다. 시각적으로 보이지는 않지만 앱에서 발생하는 이벤트를 View, ViewController에게 전달하고 ViewController과 상호작용을 통해 특정 이벤트를 실행하기 위한 객체입니다. UIWindow는 하나의 화면당 1개씩 필요하기 때문에 Muti-window를 사용하지
않는다면 보통 앱에서 1개의 UIWindow만 생성하여 사용하게 됩니다. UIWindow는 화면에 표시되지 않는 객체이기 때문에 `rootViewController` 프로퍼티에 ViewController를 할당해주어야 합니다.

아래는 UIWindow가 수행하는 역할입니다.

1. 앱의 콘텐츠를 담아냅니다.
2. UIApplication이 전달해준 이벤트를 View와 ViewController로 전달합니다.
3. ViewController와 연결되어 이벤트를 처리합니다(e.g. 오리엔테이션 변경, 키보드 노출)


### 3) AppDelegate
> [AppDelegate](https://developer.apple.com/documentation/uikit/uiapplicationdelegate)는 앱에서 발생하는 이벤트 중 일부를 UIApplication에게 전달받아 처리하는 객체입니다.

UIApplication과 마찬가지로 UIApplicationMain 메서드가 실행될 때 생성되며, 앱이 종료될때까지 UIApplication과 연결되어 시스템과의 일부 상호작용을 관리합니다. AppDelegate는 말그대로 App의 일부 역할을 위임(delegate)받아 동작하는 객체이며, UIApplication이 전달해주는 시스템의 런타임 이벤트에 대하여 AppDelegate가 어떤 처리를 할 것인지 정의함으로서 개발자가 앱의 실행에 부분적으로 관여할 수 있도록 해줍니다. UIApplicationDelegate 프로토콜의 메서드를 정의하는 방식으로 말이죠.

개발자는 AppDelegate로 아래의 작업을 처리할 수 있습니다.

사실 위의 작업보다 AppDelegate는 App의 Life Cycle을 관리하기 위해 더 많이 사용됩니다. 
iOS 12까지는 AppDelegate로 App의 Life Cycle을 관리하였으나 13부터 SceneDelegate라는 개념이 도입되며 라이프사이클을 관리하는
객체가 이전되었습니다. 이 부분은 추후 별도의 포스트로 정리하려합니다.

## UIKit 프레임워크의 핵심 객체들 초기화하기
이번에는 코드 상에서 UIApplication, UIWindow, AppDelegate가 어떻게 생성되고 초기화되는지 알아보겠습니다.
코드는 **Scene** 이라는 개념이 도입되기 이전인 iOS 12 기준의 코드입니다.
추후 Scene에 관한 블로그를 작성하면서 iOS 13부터는 코드상에서 3가지 객체를 어떻게 초기화하는지 추가로 정리할 예정입니다.

UIApplicationMain 어노테이션을 통해 UIApplicationMain가 호출되면 UIApplication이 생성되고 초기화되며
앱의 main event loop가 생성되고 UIApplication이 이 loop로 부터 발생하는 이벤트를 담당하게 되죠.

UIApplicationMain의 마지막 파라미터에 AppDelegate의 이름을 전달합니다. AppDelegate클래스의 인스턴스를 만들고, 이 인스턴스를 위에서 만든 application 객체에 할당하죠. 이 단계에서 appDelegate와 application가 연결됩니다.

그런 뒤에 그리고 application객체가 delegate메소드인 application:didFinishLaunchingWithOptions:를 호출하게 되고 앱이 실행됩니다(is almost done and the app is almost ready to run.)(https://developer.apple.com/documentation/uikit/uiapplicationdelegate/1622921-application)

그리고 이 단계에서 main UI(UIWindow)를 로드합니다. 스토리보드를 쓰지 않았기 때문. 앱의 root를 설정하고 makeKeyandVisible 메서드를 실행함으로써 앱의 key window를 이 window로 세팅하고 window에 포함된 view, viewcontroller를 표시합니다.

플로우차트가 2개가 다릅니다. 05-16